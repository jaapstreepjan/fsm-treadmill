<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fsm-treadmill: Software design</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">fsm-treadmill<span id="projectnumber">&#160;v1.1</span>
   </div>
   <div id="projectbrief">A finite state machine based on a treadmill</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('a22344.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Software design </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="secArch"></a>
Architecture subsystems view</h1>
<p>A CVM device has several <em>subsystems</em> (software API of hardware):</p><ul>
<li>Finite State Machine<ul>
<li>state_t <a class="el" href="a22310.html#a78f08da2cba1026a6339467b0da41bf4">FSM_EventHandler(const state_t state, const event_t event)</a>;</li>
<li>void <a class="el" href="a22310.html#a810caaa83c83118a51bdbd1d87fa0417">FSM_FlushEnexpectedEvents(const bool flush)</a>;</li>
<li>void <a class="el" href="a22310.html#a910a3f2f41867bd01f06de491b027cb6">FSM_AddState(const state_t state, const state_funcs_t *funcs)</a>;</li>
<li>void <a class="el" href="a22310.html#a15adcfc70c666f5c8956da799c8a4d87">FSM_AddTransition(const transition_t *transition)</a>;</li>
<li>void <a class="el" href="a22310.html#a7232dd041375d6585b39999c2b807fd4">FSM_AddEvent(const event_t event)</a>;</li>
<li>event_t <a class="el" href="a22310.html#a585470759896acd5c68f02ee7dbbebb2">FSM_GetEvent(void)</a>;</li>
<li>event_t <a class="el" href="a22310.html#aff0eca293353b2ac3d3d2659b0435e94">FSM_WaitForEvent(void)</a>;</li>
<li>event_t <a class="el" href="a22310.html#ac48e5304604c92cdae2219ee9acd72dc">FSM_PeekForEvent(void)</a>;</li>
<li>bool <a class="el" href="a22310.html#a0ec9f3c0e0d78ca8070e50de321f13cb">FSM_NoEvents(void)</a>;</li>
<li>uint8_t <a class="el" href="a22310.html#a779ec4b8b7471abd702be7b350adb7a9">FSM_NofEvents(void)</a>;</li>
</ul>
</li>
<li>Display<ul>
<li>void <a class="el" href="a22286.html#a19ffdfbb88b7984ac489cbf8445a34dc">DSPinitialise(void)</a>;</li>
<li>void <a class="el" href="a22286.html#ae1ebaffe2e4dd794cc5b80d20dd5c8fb" title="Clears full display (terminal) by executing a terminal command.">DSPclear(void)</a>;</li>
<li>void <a class="el" href="a22286.html#a98047d060c242396d1bb682126ee780d">DSPclearLine(int row)</a>;</li>
<li>void <a class="el" href="a22286.html#a693db29fcd97c6145cc6742e1bb23d69" title="Shows full display contents.">DSPshowDisplay(void)</a>;</li>
<li>void DSPshow(const char text[], int row);</li>
<li>void DSPshowDelete(const char text[], int row);</li>
<li>void DSPdebugSystemInfo(const char text[]);</li>
<li>void DSPsimulationSystemInfo(const char text[]);</li>
<li>void DSPshowSystemError(const char text[]);</li>
</ul>
</li>
<li>Keyboard<ul>
<li>void <a class="el" href="a22292.html#af43404a599f52e449ff203f6998d75f2" title="Initialises the keyboard (KYB) subsystem.">KYBinitialise(void)</a>;</li>
<li>void <a class="el" href="a22292.html#a751036558cf089782c54d6bd7ad5f3e3" title="Empty input buffer (stdin).">KYBclear(void)</a>;</li>
<li>char <a class="el" href="a22292.html#aa647ccf1ed00a48c23266cdd917aa027">KYBgetchar(void)</a>;</li>
<li>int <a class="el" href="a22292.html#affd8fad935e8e8403a1f1d357dfb54c7">KYBgetint(int ifWrongValue)</a>;</li>
<li>double <a class="el" href="a22292.html#a54a066b03c8c3cefc007d7387d7a3422">KYBgetdouble(double ifWrongValue)</a>;</li>
</ul>
</li>
<li>TUI <em>Textual User Interface</em> (terminal user interface), uses the Display and Keyboard API<ul>
<li>void TUIinitialise(void);</li>
<li>int TUIsimulationSystemInputYN(const char questionText[]);</li>
<li>char TUIsimulationSystemInputChar(const char text[], const char chrs[]);</li>
<li>int TUIsimulationSystemInputInteger(const char text[], int min, int max);</li>
</ul>
</li>
<li>FSM Initialisation and exit code<ul>
<li>void S_Init_onEntry(void);</li>
<li>void S_Exit_onEntry(void);</li>
</ul>
</li>
<li>FSM state machine for controlling the Simple example, is executed by <a class="el" href="a22316.html#a840291bc02cba5474a4cb46a9b9566fe" title="Main function where all the c code magic happens!">main()</a><ul>
<li>void <a class="el" href="a22310.html#a7232dd041375d6585b39999c2b807fd4">FSM_AddEvent(const event_t event)</a>;</li>
<li>event_t <a class="el" href="a22310.html#a585470759896acd5c68f02ee7dbbebb2">FSM_GetEvent(void)</a>;</li>
<li>event_t <a class="el" href="a22310.html#aff0eca293353b2ac3d3d2659b0435e94">FSM_WaitForEvent(void)</a>;</li>
</ul>
</li>
</ul>
<p>The arrows are code dependency relations (uses relations). In C code these are the #include dependencies.</p>
<h1><a class="anchor" id="secArchitecture"></a>
Architecture view</h1>
<p>The UML diagram describes a layered architecture for a treadmill. The layers are:</p><ul>
<li>User Interface Layer (UI): This layer contains the screen and buttons that allow the user to interact with the treadmill.</li>
<li>System Control Layer (SCL): This layer contains a finite state machine (FSM) that controls the behavior of the treadmill based on user inputs and sensor readings.</li>
<li>Subsystems Layer (SL): This layer contains the subsystems that make up the treadmill, such as the band speed motor, incline motor, and emergency brake.</li>
<li>Hardware Abstraction Layer (HAL): This layer provides an abstracted interface to the hardware, such as the hardware IO. The FSM in the SCL layer communicates with the subsystems in the SL layer, and the subsystems in turn communicate with the hardware IO in the HAL layer. The screen and buttons in the UI layer also communicate with the hardware IO in the HAL layer. <div class="image">
<img src="treadmill-architecture.png" alt="" width="600px"/>
<div class="caption">
Treadmill architecture</div></div>
</li>
</ul>
<h1><a class="anchor" id="secState"></a>
State machine view</h1>
<p>This UML code and diagram describes a state chart for a treadmill machine. It shows the different states the machine can be in, and the events that can trigger a transition between states. For example, when the machine is turned on, it goes into the S_INIT state. If the user then starts the machine, it transitions to the S_STANDBY state. From there, the user can either start running, which takes the machine to the S_DEFAULT state, or enter diagnostics mode, which takes it to the S_DIAGNOSTICS state. Each state is described by a set of actions that the machine performs while in that state. For example, in the S_DEFAULT state, the machine applies a brake to the degree of tilt and applies a constant power to the speed motor. It also allows changes to the tilt and speed to be made. Overall, this state chart describes the behavior of a treadmill machine and the different actions it can perform based on user input and other events. </p><div class="image">
<img src="treadmill-state-chart.png" alt="" width="600px"/>
<div class="caption">
Treadmill state chart</div></div>
<pre class="fragment">event [condition] / action() 
</pre><ul>
<li>if an event occurs and the condition is satisfied, then the action will be executed and the state transition will occur.</li>
<li>event names are in uppercase, prefixed by <b>E_</b>.</li>
<li>the action is the name of one or more (short) C functions without parameters or only the important ones, prefixed by the abbreviated name of the related subsystem. <br  />
</li>
<li>all the names in the diagrams should be used in the C code. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
